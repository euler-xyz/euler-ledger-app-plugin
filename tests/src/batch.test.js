import "core-js/stable";
import "regenerator-runtime/runtime";
import { waitForAppScreen, zemu, nano_models, txFromEtherscan} from './test.fixture';

// Test from replayed transaction: https://etherscan.io/tx/0x2729d32e97ed168f2671f1e1af47ce66d06022b7cc7b65ffdba9ae3aca3e6098
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Less Than Max Items 1', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0x2729d32e97ed168f2671f1e1af47ce66d06022b7cc7b65ffdba9ae3aca3e6098
  const serializedTx = txFromEtherscan("0x02f9031201458459682f0085047e21043f830b281e9459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b902a4eb937aeb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000570a7e6e75c8043bd75b574d47988aa305873818000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c60144f590ac8b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000570a7e6e75c8043bd75b574d47988aa30587381800000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c080a0bc6ebb9ff9ea627f744b3c4a41914706d3fe105d37245accb59785ba4376a3f2a0396468b90df8ae785e2efe24d1b465e4fd558257acc92d9ca29ef6f814792ef0");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 7 : 5;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_le_max_1', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0xfc722723b02be2b1fe1f5eeaf8045201a18cc51c9cb361c8ef1df741c67655c5
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Less Than Max Items 2', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0xfc722723b02be2b1fe1f5eeaf8045201a18cc51c9cb361c8ef1df741c67655c5
  const serializedTx = txFromEtherscan("0x02f906f2014e8459682f00850270a9c5588312c16c9459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b90684eb937aeb0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000062000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000003e000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000570a7e6e75c8043bd75b574d47988aa30587381800000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba341000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e482d7af8f0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca0000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000035e3c01559b180000000000000000000000000000000000000000000000000003a4816d2d62d500000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000a8e449022e00000000000000000000000000000000000000000000000000035e3c01559b180000000000000000000000000000000000000000000000000003a4816d2d62d500000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000d340b57aacdd10f96fc1cf10e15921936f41e29c0c639763000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000198472c9e552c2afc1b096d4f1a35c08a52ff1000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006423b872dd00000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc200000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc30000000000000000000000000000000000000000000000000d7a1cd64de6359a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d30000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000004473f0b4370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d9fcd98c322942075a5c3860693e9f4f03aae07b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc300000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc2c001a0be94aa58c3886a96d6aa34001a1ddeef70dbdf27e1698cf1153c16a3e05bb74da024c50f09ab025489350dc6db024f4843a9d94b091b97d56b1efdb7b0245c3bcf");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 8 : 6;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_le_max_2', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0x499a7a440730d2faf5888c6bc52e1f41d4ef2f5cb6e9364301deb929467bbe66 
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Less Than Max Items 3', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0x499a7a440730d2faf5888c6bc52e1f41d4ef2f5cb6e9364301deb929467bbe66 
  const serializedTx = txFromEtherscan("0x02f9043201518459682f008502e3ae8933830e33e19459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b903c4eb937aeb0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba341000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001642284879500000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000352d50d6a4fa1000000000000000000000000000000000000000000000000000000006334e55700000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000002ba0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f4c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000570a7e6e75c8043bd75b574d47988aa30587381800000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044441a3e700000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c001a091a3b505ba293db22d1d3968584ab721ecba3f9bec9457bc2be812ba3e1c2457a0014ba6360a2b29945d33945d97ee9cf18ddeb061639306530e7e6a9b1823e5d4");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 7 : 5;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_le_max_3', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0x35f87ab46f8192b1ff29c9fc47787619833fef5d1da4acb6f6c9aacec7338cea
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Equals Max Items ', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0x35f87ab46f8192b1ff29c9fc47787619833fef5d1da4acb6f6c9aacec7338cea
  const serializedTx = txFromEtherscan("0x02f907d2014f8459682f008502b37666a38318e8a39459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b90764eb937aeb00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000720000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000198472c9e552c2afc1b096d4f1a35c08a52ff10000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044441a3e700000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eb91861f8a4e1c12333f42dce8fb0ecdc28da71600000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044e2bbb158000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008f222fc08bd508571fce098cab5bb4095346a561000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000440ecbcdab00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002d7e18fd47cef000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000570a7e6e75c8043bd75b574d47988aa30587381800000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba3410000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020482d7af8f000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000f423f0000000000000000000000000000000000000000000000000002a15818ca7a0d00000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000c82e95b6c8000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4800000000000000000000000000000000000000000000000000000000000f423f0000000000000000000000000000000000000000000000000002a15818ca7a0d0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000100000000000000003b6d03403aa370aacf4cb08c7e1e7aa8e8ff9418d73c7e0f0c63976300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c001a0f529fda90e979da883fe1f63367359282a745d0050eaf629196ed76a1fc43993a0581facc756a3d152f332cc28243db9a491e56696e87f261dcb8ed50aec9e4395");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 9 : 7;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_eq_max', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0xae79fe7523dc9648558ff91193c7dc65a8f1b0db00c35dadd8a46a8a8e6b9b7e
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] More Than Max Items 1', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0xae79fe7523dc9648558ff91193c7dc65a8f1b0db00c35dadd8a46a8a8e6b9b7e
  const serializedTx = txFromEtherscan("0x02f90af201508459682f008502775d644c83194d8e9459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b90a84eb937aeb00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000a40000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000620000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000007e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d30000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000004473f0b4370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eb91861f8a4e1c12333f42dce8fb0ecdc28da716000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba3410000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020482d7af8f000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000002a1ad3837c5c100000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000c82e95b6c8000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4800000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000002a1ad3837c5c10000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000100000000000000003b6d0340b4e16d0168e52d35cacd2c6185b44281ec28c9dc0c639763000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eb91861f8a4e1c12333f42dce8fb0ecdc28da71600000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000436548baab5ec4d79f669d1b9506d67e98927af7000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000440ecbcdab000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd1bd5c956684f7eb79da40f582cbe1373a1d59300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba3410000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000016422848795000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004b2f1758ee1cc000000000000000000000000000000000000000000000000000000006334e4e900000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000002b7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0000064c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c080a0546ceaf7cccf494cfee88cc023fb4d4d198938c0ec5fbcaa3a99b3c0f4a04ba3a0105892bd9157411802e29f43d6680dcda100d7f0539d360d88fca177b9ffa48e");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 8 : 7;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_gt_max_1', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0x2ca4c2257f7716c0ba575c19ef7e2c6703eb3c2728bded563c33afb24bc69f9b
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] More Than Max Items 2', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0x2ca4c2257f7716c0ba575c19ef7e2c6703eb3c2728bded563c33afb24bc69f9b
  const serializedTx = txFromEtherscan("0xf90d0d82018e850218711a0083157fc89459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b90ca4eb937aeb00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000c40000000000000000000000000000000000000000000000000000000000000000900000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000000000000000000000000000000000000000082000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004d19f33948b99800b6113ff3e83bec9b537c85d200000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000002ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004d19f33948b99800b6113ff3e83bec9b537c85d20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006423b872dd0000000000000000000000004dcbb1fe5983ad5b44dc661273a4f11ca812f8ba0000000000000000000000004dcbb1fe5983ad5b44dc661273a4f11ca812f8b80000000000000000000000000000000000000000000012bcf94ead5ebf380d1a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d30000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000004473f0b4370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004d19f33948b99800b6113ff3e83bec9b537c85d2000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000014dab74b3a40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004d19f33948b99800b6113ff3e83bec9b537c85d200000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba341000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e482d7af8f000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000000000000000000000000000000000000015fedfa6000000000000000000000000000000000000000000000013e71128b865a8bd9a00000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000a8e449022e0000000000000000000000000000000000000000000000000000000015fedfa6000000000000000000000000000000000000000000000013e71128b865a8bd9a0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000180000000000000000000000048da0965ab2d2cbf1c17c09cfb5cbe67ad5b14060c639763000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e025e3ca2be02316033184551d4d3aa22024d9dc00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba341000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001642284879500000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000071787c0000000000000000000000000000000000000000000000000000000063338b2500000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000002b6b175474e89094c44da98b954eedeac495271d0f000064dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044441a3e70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001056c1f9e6ec4cb1a20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000004dcbb1fe5983ad5b44dc661273a4f11ca812f8ba0000000000000000000000004dcbb1fe5983ad5b44dc661273a4f11ca812f8b825a0d23821fa5b043ce8ea7299afcca7fb2abd2130318b0662779a86abf68daf7e1ca01759fdb4fbf8d890548976c6f216d1cc52f169db811a7e1e967d1a55b387b622");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = 7;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_gt_max_2', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0xd97009aa3b733a9e52b909543af7af31189c0ed4999823a3991fa50c16795e8b
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] More Than Max Items 3', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0xd97009aa3b733a9e52b909543af7af31189c0ed4999823a3991fa50c16795e8b
  const serializedTx = txFromEtherscan("0x02f9071201528459682f008503505af31a830c9c729459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b906a4eb937aeb00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000660000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000000000440000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000085e0391297ae230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000085e0393ab855900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000085e03926a801fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000441b2ef1ca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0a6aba3b928630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000086f266d27c71740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b808f49add4b8c6b5117d9681cf7312fcf0dc1d00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c001a0954f5c816f5abc2b00c7b0d84ce2fc7afdf02a77f3d1b08a3ecff83e0ba0a66aa029141429277cdefeb19e181cca65c55d6ae46a3c65c67cba605efdaa60aace55");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 9 : 7;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_batch_gt_max_3', [right_clicks, 0]);

  await tx;
  }));
});
