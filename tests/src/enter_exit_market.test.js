import "core-js/stable";
import "regenerator-runtime/runtime";
import { waitForAppScreen, zemu, nano_models, txFromEtherscan} from './test.fixture';

// Test from replayed transaction: https://etherscan.io/tx/0xc75a6deecb895692770e93bc4f07d250676d50c5b5c1fc115bb3f32e401e29a6
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Enter Market', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0xc75a6deecb895692770e93bc4f07d250676d50c5b5c1fc115bb3f32e401e29a6
  const serializedTx = txFromEtherscan("0x02f9021201468459682f008502a5bbacc78302ba349459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b901a4eb937aeb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d30000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000004473f0b4370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d9fcd98c322942075a5c3860693e9f4f03aae07b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c080a0df80d5d659050f0e0274e668c907e70c6da52cca995e875f84008a35fd8e50e8a07598e7b480d810f7eba63091037fd468b7ccb0d6662fa3bc7cf4576a21e65a10");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 8 : 5;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_enter_market', [right_clicks, 0]);

  await tx;
  }));
});

// Test from replayed transaction: https://etherscan.io/tx/0x51bdb538cfcfbaf943e3b98e6359396a5a12b37040708236c892b9ba55f2a058
nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Exit Market', zemu(model, async (sim, eth) => {

  // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0x51bdb538cfcfbaf943e3b98e6359396a5a12b37040708236c892b9ba55f2a058
  const serializedTx = txFromEtherscan("0x02f9021201478459682f00850285c3f241830257979459828fdf7ee634aaad3f58b19fdba3b03e2d9d8080b901a4eb937aeb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044c8a5fba30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d9fcd98c322942075a5c3860693e9f4f03aae07b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000092f16b08a272c2a3048d93ee807fd3b6225e3bc3c080a07edeca76838949fa1e03ca1fe4cb9e83b19f337504109c8e08e4628c369cb225a0061cf339ab936a55c0399ffb68afc841f71bef312f4e209627fd8ad0575def3e");

  const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

  const right_clicks = model.letter === 'S' ? 9 : 5;

  // Wait for the application to actually load and parse the transaction
  await waitForAppScreen(sim);

  // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
  await sim.navigateAndCompareSnapshots('.', model.name + '_exit_market', [right_clicks, 0]);

  await tx;
  }));
});
